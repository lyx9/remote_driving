# FSM-Pilot è¿œç¨‹é©¾é©¶ç³»ç»Ÿ

<div align="center">

![Version](https://img.shields.io/badge/version-1.1.0-blue.svg)
![Platform](https://img.shields.io/badge/platform-Ubuntu%2022.04-orange.svg)
![ROS2](https://img.shields.io/badge/ROS2-Humble-green.svg)
![License](https://img.shields.io/badge/license-MIT-brightgreen.svg)

**åŸºäº ROS2 å’Œ WebRTC çš„äº§å“çº§è¿œç¨‹é©¾é©¶å¹³å°**

[å¿«é€Ÿå¼€å§‹](#å¿«é€Ÿå¼€å§‹) â€¢
[æ–‡æ¡£](#æ–‡æ¡£) â€¢
[Demo æ¼”ç¤º](#demo-æ¼”ç¤º) â€¢
[æ¶æ„](#ç³»ç»Ÿæ¶æ„)

</div>

---

## åŠŸèƒ½ç‰¹æ€§

### æ ¸å¿ƒåŠŸèƒ½
- **å¤šè½¦è¾†è¿œç¨‹æ§åˆ¶** - æ”¯æŒåŒæ—¶ç®¡ç†å’Œåˆ‡æ¢å¤šè¾†è‡ªåŠ¨é©¾é©¶è½¦è¾†
- **å®æ—¶è§†é¢‘ä¼ è¾“** - 5è·¯æ‘„åƒå¤´ä½å»¶è¿Ÿè§†é¢‘æµï¼ŒåŸºäº WebRTC
- **æ™ºèƒ½è°ƒåº¦ç³»ç»Ÿ** - å¤šç®—æ³•æ”¯æŒçš„è½¦è¾†ä¼˜å…ˆçº§è°ƒåº¦
- **ç½—æŠ€æ–¹å‘ç›˜æ”¯æŒ** - G29/G920 æ–¹å‘ç›˜å®Œæ•´æ”¯æŒï¼Œå«åŠ›åé¦ˆ
- **å‘Šè­¦ç›‘æ§ç³»ç»Ÿ** - å®æ—¶å‘Šè­¦åˆ†æå’Œé€šçŸ¥
- **å»¶è¿Ÿè¡¥å¿å¯è§†åŒ–** - é¢„æµ‹æ¨¡å‹æ¥å£ï¼Œæ”¯æŒå»¶è¿Ÿè¡¥å¿æ˜¾ç¤º

### å‰ç«¯åŠŸèƒ½
- ğŸ¥ **å¤šæ‘„åƒå¤´è§†é¢‘å¢™** - 1ä¸»+4PIP å®æ—¶è§†é¢‘æ˜¾ç¤º
- ğŸ—ºï¸ **å®æ—¶åœ°å›¾å¯¼èˆª** - åŸºäº Leaflet çš„è½¦è¾†å®šä½
- ğŸ¯ **æ¿€å…‰é›·è¾¾å¯è§†åŒ–** - Three.js 3D ç‚¹äº‘æ¸²æŸ“
- ğŸš— **è½¦é˜Ÿç®¡ç†** - å¤šè½¦çŠ¶æ€ç›‘æ§å’Œå¿«é€Ÿåˆ‡æ¢
- ğŸ“Š **é¥æµ‹æ•°æ®** - é€Ÿåº¦ã€æ–¹å‘ã€æ¡£ä½å®æ—¶æ˜¾ç¤º
- ğŸ“¹ **é»‘ç›’å½•åˆ¶** - å¤šé€šé“æ•°æ®åŒæ­¥è®°å½•

## ç³»ç»Ÿæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      FSM-Pilot ç³»ç»Ÿæ¶æ„                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚   â”‚   è½¦ç«¯èŠ‚ç‚¹   â”‚â—„â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚   äº‘ç«¯æœåŠ¡   â”‚â—„â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚  æ“ä½œç«¯  â”‚ â”‚
â”‚   â”‚  (ROS2 C++) â”‚  WebRTC â”‚   (C++)     â”‚   WS    â”‚  (Vue 3) â”‚ â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚         â”‚                       â”‚                       â”‚       â”‚
â”‚    Autoware              è°ƒåº¦/å‘Šè­¦/ä¿¡ä»¤              æ–¹å‘ç›˜     â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚

- Ubuntu 22.04 LTS
- Node.js 18+
- (å¯é€‰) ROS2 Humble, CMake 3.16+

### å®‰è£…

```bash
# å…‹éš†é¡¹ç›®
git clone <repository_url> fsm
cd fsm

# å®‰è£…å‰ç«¯ä¾èµ–
npm install

# å®‰è£… Mock æœåŠ¡ä¾èµ–
cd mock && npm install && cd ..
```

### è¿è¡Œ Demo

```bash
# ä¸€é”®å¯åŠ¨ Demo ç¯å¢ƒ (æ¨è)
./scripts/start_demo.sh

# æˆ–æ‰‹åŠ¨å¯åŠ¨
# ç»ˆç«¯ 1: Mock æœåŠ¡
cd mock && npm start

# ç»ˆç«¯ 2: å‰ç«¯
npm run dev
```

è®¿é—® http://localhost:5173 æŸ¥çœ‹ç•Œé¢ã€‚

### ç¼–è¯‘ C++ åç«¯ (ç”Ÿäº§ç¯å¢ƒ)

```bash
# å®‰è£…ä¾èµ– (å‚è§ docs/BUILD_GUIDE.md)
cd cpp && mkdir build && cd build
cmake .. -DCMAKE_BUILD_TYPE=Release
make -j$(nproc)
```

## Demo æ¼”ç¤º

### é¢„ç½®æ¼”ç¤ºåœºæ™¯

| åœºæ™¯ | æè¿° | æ—¶é•¿ |
|------|------|------|
| å•è½¦è¿œç¨‹æ§åˆ¶ | å±•ç¤ºåŸºæœ¬çš„è¿æ¥å’Œæ§åˆ¶åŠŸèƒ½ | 30ç§’ |
| ç´§æ€¥åœè½¦æ¼”ç¤º | å±•ç¤ºç´§æ€¥åœè½¦å’Œæ¢å¤ | 20ç§’ |
| ç½‘ç»œå¼‚å¸¸æ¼”ç¤º | å±•ç¤ºç½‘ç»œä¸­æ–­å¤„ç† | 25ç§’ |
| å¤šè½¦è°ƒåº¦æ¼”ç¤º | å±•ç¤ºå¤šè½¦åˆ‡æ¢å’Œè°ƒåº¦ | 30ç§’ |

### æ¨¡æ‹Ÿæ§åˆ¶å‘½ä»¤

```bash
# æ¨¡æ‹Ÿç½‘ç»œå»¶è¿Ÿ
./scripts/simulate_network.sh delay

# æ¨¡æ‹Ÿç½‘ç»œæ–­å¼€
./scripts/simulate_network.sh disconnect

# è§¦å‘ç´§æ€¥åœè½¦
./scripts/simulate_emergency.sh FSM-01 trigger

# æ¢å¤æ­£å¸¸
./scripts/simulate_network.sh reset
```

## æ–‡æ¡£

| æ–‡æ¡£ | è¯´æ˜ |
|------|------|
| [ç¼–è¯‘æŒ‡å—](docs/BUILD_GUIDE.md) | è¯¦ç»†çš„ç¼–è¯‘å’Œå®‰è£…è¯´æ˜ |
| [ä½¿ç”¨æŒ‡å—](docs/USAGE_GUIDE.md) | ç³»ç»Ÿä½¿ç”¨å’Œæ“ä½œè¯´æ˜ |
| [Demo æŒ‡å—](docs/DEMO_GUIDE.md) | æ¼”ç¤ºåœºæ™¯å’Œè„šæœ¬ |
| [ç³»ç»Ÿæ¶æ„](docs/SYSTEM_ARCHITECTURE.md) | è¯¦ç»†çš„ç³»ç»Ÿè®¾è®¡æ–‡æ¡£ |
| [æµ‹è¯•ç”¨ä¾‹](docs/TEST_CASES.md) | æµ‹è¯•ç”¨ä¾‹å’ŒéªŒæ”¶æ ‡å‡† |

## é¡¹ç›®ç»“æ„

```
fsm/
â”œâ”€â”€ cpp/                      # C++ åç«¯
â”‚   â”œâ”€â”€ common/              # å…¬å…±åº“ (é…ç½®/æ—¥å¿—/å·¥å…·)
â”‚   â”œâ”€â”€ vehicle_node/        # è½¦ç«¯ ROS2 èŠ‚ç‚¹
â”‚   â”œâ”€â”€ cloud_server/        # äº‘ç«¯æœåŠ¡ (ä¿¡ä»¤/è°ƒåº¦/å‘Šè­¦)
â”‚   â””â”€â”€ operator_client/     # æ“ä½œç«¯å®¢æˆ·ç«¯ (æ–¹å‘ç›˜)
â”œâ”€â”€ src/                     # Vue 3 å‰ç«¯
â”‚   â”œâ”€â”€ components/          # Vue ç»„ä»¶
â”‚   â”œâ”€â”€ stores/              # Pinia çŠ¶æ€ç®¡ç†
â”‚   â”œâ”€â”€ services/            # åç«¯æœåŠ¡å±‚
â”‚   â””â”€â”€ composables/         # Vue Composables
â”œâ”€â”€ mock/                    # Mock æ•°æ®æœåŠ¡
â”œâ”€â”€ scripts/                 # å¯åŠ¨å’Œæ¨¡æ‹Ÿè„šæœ¬
â””â”€â”€ docs/                    # æ–‡æ¡£
```

## é…ç½®

### è½¦ç«¯é…ç½® (vehicle_config.yaml)

```yaml
vehicle:
  id: "FSM-01"
  type: "ROBO-TAXI"

sensors:
  cameras:
    - id: "cam_front_center"
      topic: "/sensing/camera/front_center/image_raw"
      fps: 30
      width: 1920
      height: 1080

webrtc:
  signaling:
    url: "wss://your-server.com:8080/signaling"
```

### äº‘ç«¯é…ç½® (cloud_config.yaml)

```yaml
server:
  signaling_port: 8080
  api_port: 8081

scheduling:
  enabled: true
  algorithm: "weighted_priority"
  weights:
    emergency: 0.35
    latency: 0.25
    distance: 0.20
    battery: 0.10
```

## æŠ€æœ¯æ ˆ

### åç«¯ (C++)
- **æ¡†æ¶**: ROS2 Humble + Autoware.universe
- **é€šä¿¡**: WebRTC (libdatachannel), WebSocket (Boost.Beast)
- **åºåˆ—åŒ–**: Protocol Buffers
- **é…ç½®**: YAML-cpp
- **æ—¥å¿—**: spdlog

### å‰ç«¯ (TypeScript)
- **æ¡†æ¶**: Vue 3 Composition API
- **çŠ¶æ€**: Pinia
- **æ„å»º**: Vite
- **åœ°å›¾**: Leaflet
- **3D**: Three.js

## API æ¥å£

### REST API

```
GET    /api/v1/vehicles              # è·å–è½¦è¾†åˆ—è¡¨
GET    /api/v1/vehicles/{id}/status  # è·å–è½¦è¾†çŠ¶æ€
GET    /api/v1/scheduling/queue      # è·å–è°ƒåº¦é˜Ÿåˆ—
GET    /api/v1/alerts                # è·å–å‘Šè­¦åˆ—è¡¨
PUT    /api/v1/scheduling/config     # æ›´æ–°è°ƒåº¦é…ç½®
```

### WebSocket äº‹ä»¶

```javascript
// è½¦è¾†çŠ¶æ€æ›´æ–°
{ "event": "vehicle_status", "data": { vehicle_id, speed, steering, ... } }

// å‘Šè­¦
{ "event": "alert", "data": { id, vehicle_id, severity, message } }

// è°ƒåº¦æ›´æ–°
{ "event": "scheduling_update", "data": { queue: [...] } }

// ç´§æ€¥çŠ¶æ€
{ "event": "emergency", "data": { vehicle_id, active } }
```

## æ–¹å‘ç›˜æ”¯æŒ

| å‹å· | æ”¯æŒçŠ¶æ€ |
|------|----------|
| Logitech G29 | âœ… å®Œå…¨æ”¯æŒ |
| Logitech G920 | âœ… å®Œå…¨æ”¯æŒ |
| Logitech G27 | âœ… æ”¯æŒ |
| Logitech G923 | âœ… æ”¯æŒ |

### æŒ‰é’®æ˜ å°„

| æŒ‰é’® | åŠŸèƒ½ |
|------|------|
| X (çº¢è‰²) | ç´§æ€¥åœè½¦ |
| â–¡ (æ–¹å—) | å–‡å­ |
| L1/R1 | å·¦/å³è½¬å‘ç¯ |
| å·¦/å³æ‹¨ç‰‡ | é™æ¡£/å‡æ¡£ |

## å¼€å‘

### å¯åŠ¨å¼€å‘ç¯å¢ƒ

```bash
# å‰ç«¯å¼€å‘
npm run dev

# Mock æœåŠ¡
cd mock && npm start

# C++ ç¼–è¯‘
cd cpp/build && make -j4
```

### ä»£ç é£æ ¼

- C++: Google C++ Style Guide
- TypeScript: ESLint + Prettier
- Vue: Composition API

## è®¸å¯è¯

MIT License

---

<div align="center">
  <sub>Built with â¤ï¸ for autonomous driving</sub>
</div>
